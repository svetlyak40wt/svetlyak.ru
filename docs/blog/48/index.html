<!DOCTYPE html>
<html>

<head>
<title>Боремся за динамический диапазон | Блог о фотографии Большого 40вт Светляка</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="description" content="Это блог о фотографии, самодельных камерах и альтернативных способах печати."/>
<meta name="keywords" content="фотограф,фотография,pinhole,сделай сам,цианотипия,альтернативная печать,правила фотографии,технологии,урок,resources,autopano,output,qpfstmo,img_fl,pfstools,Боремся за динамический диапазон"/>
<link rel="icon" href="http://media.svetlyak.ru/images/favicon.ico" type="image/x-icon"/>
<link rel="home" href="/" />
<link rel="help" href="/blog/kak-chitat-etot-blog/" />
<link rel="author" href="/blog/contacts/" title="Александр Артёменко" />
<link rel="me" type="text/html" href="http://www.google.com/profiles/svetlyak.40wt" />

<link rel="alternate" type="application/atom+xml" title="Блог" href="http://feeds.feedburner.com/40-wt-firefly" />
<link rel="alternate" type="application/atom+xml" title="Фотографии" href="http://feeds.feedburner.com/40-wt-firefly/photos" />
<link rel="alternate" type="application/atom+xml" title="Twitter" href="http://twitter.com/statuses/user_timeline/7148262.atom" />

<link rel="openid.server" href="http://openid.yandex.ru/server/" />
<link rel="openid2.provider" href="http://openid.yandex.ru/server/" />
<link rel="openid.delegate" href="http://openid.yandex.ru/alexander-artemenko/" />
<link rel="openid2.local_id" href="http://openid.yandex.ru/alexander-artemenko/" />
<link rel="pavatar" href="http://media.svetlyak.ru/pavatar.png" />


    <link href="http://media.svetlyak.ru/css/screen.css" rel="stylesheet" type="text/css" media="screen,projection" /><link href="http://media.svetlyak.ru/css/links/skin.css" rel="stylesheet" type="text/css" media="screen,projection" /><link href="http://media.svetlyak.ru/css/jquery.jcarousel.css" rel="stylesheet" type="text/css" media="screen,projection" />
    <!--[if lt IE 8]>
        <link href="http://media.svetlyak.ru/css/ie.css" rel="stylesheet" type="text/css" media="screen,projection" />
    <![endif]-->
    <link href="http://media.svetlyak.ru/css/print.css" rel="stylesheet" type="text/css" media="print" />



    <script type="text/javascript" src="//yandex.st/share/share.js" charset="utf-8"></script>
    <script type="text/javascript" src="http://media.svetlyak.ru/js/common/jquery-1.3.2.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/common.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/common/comments.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/gallery/lightbox.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/gallery/controls.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/downloadr.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/gallery/jqpanview.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/flashdetect.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/image_stack.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/jquery.jcarousel.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/jquery.jeditable.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/blog.js" charset="utf-8"></script><script type="text/javascript" src="http://media.svetlyak.ru/js/share.js" charset="utf-8"></script>




    
        
            <link rel="next" href="/blog/opticheskij-filtr-s-pomoschyu-folgi/" title="Оптический фильтр с помощью фольги" />
        
        
            <link rel="prev" href="/blog/fed-2-ili-betmen-vozvraschaetsya/" title="ФЭД-2, или Бэтмен возвращается!" />
        
    

<link rel="top" href="/blog/" />

</head>

<body class="blog main">
<!-- Container -->
<div class="container">
    
        <table class="header">
            <tbody>
            <tr>
                
                <td class="breadcrumbs">
                    <a href="/"><b>svetlyak.ru</b></a> &rarr;
                    

    
        <a href="/blog/">Блог</a> &rarr;
    

    
        Боремся за динамический диапазон
    




                </td>
                
                
                <td class="search">
                    
<form action="/search/" method="get">
    <table><tbody><tr>
    <td width="100%"><input type="text" name="text" value=""/></td>
    <td><input type="submit" value="Поиск"/></td>
    </tr></tbody></table>
</form>

    <p class="example">Пример: <a class="dont-touch" rel="nofollow" href="/search/?text=проявка пленки">проявка пленки</a></p>


                </td>
                
            </tr>
            </tbody>
        </table>
    

        <!-- Content -->
        <!--[if lt IE 7]>
        <p class="ie-warning">Дорогие пользователи IE 6, не пользуйтесь устаревшим браузером, поставьте новый и красивый <a href="/redir/?url=http%3A%2F%2Fie.yandex.ru%2F">Internet Explorer 8</a> или <a href="/redir/?url=http%3A%2F%2Ffx.yandex.ru%2F">Firefox</a>.</p>
        <![endif]-->
        <div class="content">
            <h1 class="post-title">Боремся за динамический диапазон</h1>
            
    

    <div class="b-post-props append-bottom">
        <div>Октябрь 17 2006 23:31</div>
        
        
        
            <div class="tags-container">
                Метки:
                
                <div id="13-48-tags" class="tags">

    <a href="/blog/tags/tehnologii/" rel="tag">технологии</a>, 

    <a href="/blog/tags/urok/" rel="tag">урок</a>

</div>
                
                (<a href="/blog/tags/">все метки</a>)
            </div>
        
        
        
    </div>




            
            
    
        <div class="article">
            <!-- Яндекс.Директ -->
            <div id="yandex_ad">
                
            </div>
            <script type="text/javascript">
            (function(w, d, n, s, t) {
                w[n] = w[n] || [];
                w[n].push(function() {
                    Ya.Direct.insertInto(103894, "yandex_ad", {
                        stat_id: 3,
                        site_charset: "utf-8",
                        ad_format: "direct",
                        font_size: 1,
                        type: "vertical",
                        limit: 4,
                        title_font_size: 3,
                        site_bg_color: "FFFFFF",
                        header_bg_color: "FEEAC7",
                        title_color: "0000CC",
                        url_color: "006600",
                        text_color: "000000",
                        hover_color: "0066FF",
                        favicon: true
                    });
                });
                t = d.documentElement.firstChild;
                s = d.createElement("script");
                s.type = "text/javascript";
                s.src = "http://an.yandex.ru/system/context.js";
                s.setAttribute("async", "true");
                t.insertBefore(s, t.firstChild);
            })(window, document, "yandex_context_callbacks");
            </script>

            
            
                <p class="icon"><img alt="" src="http://media.svetlyak.ru/blog/common/070821/icon-hdr.png" title="HDR" /></p>
<h2>Введение</h2>
<p>На сегодняшний день, в большинстве форматов хранения цифровых изображений для представления цвета и светимости точек ограниченное число бит, например 8 или 16 бит на канал. При этом, цвет кодируется таким образом, чтобы наилучшим образом учесть человеческое восприятие, для чего применяется так называемая &#171;гамма&nbsp;коррекция&#187;.</p>
<p>Увы, с помощью ограниченного числа бит невозможно зафиксировать все то многообразие цветовых оттенков, что существует в реальном мире. Для обозначения диапазона яркостей, которые могут быть зафиксированы одновременно на носителе (фотоплёнке, фотобумаге, фотопластинке) либо с помощью матрицы цифрового фотоаппарата был введен специальный термин &#8212; <a href="http://ru.wikipedia.org/wiki/%D0%94%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B4%D0%B8%D0%B0%D0%BF%D0%B0%D0%B7%D0%BE%D0%BD_%28%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F%29">динамический диапазон</a> (или фотографическая&nbsp;широта).</p>
<p>Чтобы обойти существующие ограничения широту динамического диапазона, была разработана специальная технология <span class="caps">HDRI</span> (High Dynamic Range Imaging). Эта технология была придумана Полом Дебевеком (Paul Debevec), который первый предложил использовать карты <span class="caps">HDRI</span> для создания реалистичного освещения в компьютерной&nbsp;графике.</p>
<p>В <span class="caps">HDR</span> изображениях, в отличие от классических форматов, хранится информация описывающая физическую светимость объектов реального мира. В этом <span class="caps">HDR</span> изображения отличаются от изображений, которые предназначены для вывода на монитор или печать. Традиционные цифровые изображения принято называть &#171;аппаратно-зависимыми&#187;, а <span class="caps">HDR</span> изображения &#8212;&nbsp;&#187;сцено-зависимыми&#187;.</p>
<p>Основной проблемой <span class="caps">HDR</span> изображений является их просмотр. ЭЛТ и ЖК мониторы, а так же принтеры способны воспроизводить только изображения с узким динамическим диапазоном (<span class="caps">LDR</span>), поэтому были придуманы методы &#171;конвертирования&#187; <span class="caps">HDR</span> изображений в <span class="caps">LDR</span> &#8212; методы <em>тонирования</em>.</p>
<p>К сожалению, динамический диапазон матриц современных цифровых фотоаппаратов оставляет желать лучшего. Наверное многие из вас замечали, что фотографируя пейзаж без применения каких либо специальных фильтров сложно добиться одновременного контраста и земли, и неба. Это происходит из за того, что яркость различных частей снимка &#171;не укладывается&#187; в динамический диапазон камеры. Выхода тут как минимум два: либо использовать специальный фильтр, либо сделать несколько кадров с разной экспозицией для последующего перевода их в <span class="caps">HDRI</span>. Именно о последнем случае я и хочу&nbsp;рассказать.</p>
<p>Для выполнения действий, описанных ниже, вам скорее всего потребуется ОС Linux (или его &#171;эмуляция&#187; &#8212; <a href="http://www.cygwin.com/">Cygwin</a>) и вот эти&nbsp;программы:</p>
<ul>
<li><a href="http://user.cs.tu-berlin.de/~nowozin/autopano-sift/">autopano</a> &#8212; программа для автоматического совмещения изображений (есть версия под&nbsp;Windows);</li>
<li><a href="http://hugin.sourceforge.net/">hugin</a> &#8212; инструмент, в основном предназначенный для создания панорам, но и нам сгодится (есть версия под&nbsp;Windows);</li>
<li><a href="http://www.imagemagick.org">ImageMagick</a> &#8212; набор утилит по преобразованию (есть версия под&nbsp;Windows);</li>
<li><a href="http://www.gnu.org/software/bash/">bash</a> &#8212; командный процессор, нужен для выполнения небольших скриптов (входит в&nbsp;Cygwin);</li>
<li><a href="http://www.mpi-inf.mpg.de/resources/pfstools/">pfstools</a> &#8212; набор утилит для работы с <span class="caps">HDRI</span> (должно быть портабельно, по крайней мере авторы пишут, что собирается под&nbsp;Cygwin);</li>
<li><a href="http://www.mpii.mpg.de/resources/hdr/calibration/pfs.html">pfscalibration</a> &#8212; утилиты для обработки цветовой&nbsp;информации;</li>
<li><a href="http://www.mpi-sb.mpg.de/resources/tmo/">pfstmo</a> &#8212; утилиты для выполнения тонирования с применением различных&nbsp;алгоритмов;</li>
<li><a href="http://theplaceofdeadroads.blogspot.com/2006/07/qpfstmo-hdr-tone-mapping-gui-for-linux_04.html">qpfstmo</a> &#8212; графическая оболочка для qpfstmo (использует Qt, так что наверное можно скомпилировать версию и под&nbsp;Windows).</li>
</ul>
<h2>Стартовая&nbsp;позиция</h2>
<p>Итак, что мы имеем? Предположим, что у нас есть серия картинок, и каждая из них по отдельности &#8212; где-то мало деталей в тенях, где-то выбеленные света. Для теста я специально отснял серия из 11 фотографий &#8212; 1 фото с нормальной экспозицией и еще по 5 в минус и плюс с шагом в одну ступень.
Этого даже больше чем достаточно.
Вот все 11&nbsp;картинок:</p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0000.jpg" title="out0000" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0001.jpg" title="out0001" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0002.jpg" title="out0002" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0003.jpg" title="out0003" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0004.jpg" title="out0004" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0005.jpg" title="out0005" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0006.jpg" title="out0006" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0007.jpg" title="out0007" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0008.jpg" title="out0008" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0009.jpg" title="out0009" /></p>
<p class="img_fl"><img alt="" src="http://media.svetlyak.ru/blog/070905/out0010.jpg" title="out0010" /></p>
<p class="cb" />
<p>Я предполагаю, что изначально вы имеете cерию <span class="caps">TIFF</span> файлов. Если у вас изображения в <span class="caps">RAW</span> формате, то их необходимо сконвертировать в <span class="caps">TIFF</span> с помощью вашей любимой программы. Я делаю это в BibblePro. Если хотите, можете скачать <a href="http://svetlyak.ru/files/hdr_tutorial_src.rar">архив с <span class="caps">JPG</span> версиями исходных файлов</a>, которые использовались в этом&nbsp;уроке.</p>
<h2>Использование autopano и hugin для подгонки&nbsp;снимков</h2>

<p>Многие ошибочно полагают, что снимать панораму или серию фото для <span class="caps">HDRI</span> без штатива абсолютно бесполезно, так как будет сложно свести эти изображения воедино. На самом деле это не так. Существуют программы, автоматизирующие &#171;склейку&#187; фотографий. В мире open source это autopano и hugin. Мы будем использовать autopano для автоматического определения общих точек на разных снимках, а hugin &#8212; для совмещения фотографий. Большим плюсом hugin является то, что он способен работать с 16 битами на канал, так что мы не потеряем качество картинок после выполнения всех&nbsp;преобразований.</p>
<p>А вот autopano, к сожалению, не умеет работать с <span class="caps">TIFF</span> форматом, поэтому для него необходимо сделать <span class="caps">JPEG</span> версии файлов такого же размера, как <span class="caps">TIFF</span>. Для этого я использую либо BibblePro, либо такой вот&nbsp;скриптик:</p>
<pre><code>for i in *.tif;do \
    echo Converting $i; \
    convert $i[0] `basename $i tif`jpg &amp;amp;&amp; \
    exiftool -TagsFromFile $i -overwrite_original_in_place `basename $i tif`jpg; \
done
</code></pre>
<p>Очень важно на этом этапе сохранить exif теги в <span class="caps">JPG</span> файлах, так как информация о выдержке и диафрагме, которая хранится в тегах, скоро нам&nbsp;понадобится!</p>
<p>После того, как изображения готовы к обработке, Запускаем autopanog, добавляем файлы, жмем кнопку&nbsp;рассчитать:</p>
<p class="img_c"><img alt="" src="http://media.svetlyak.ru/blog/070905/autopano1.png" title="autopano1" /></p>
<p>Можно так же просто использовать такую&nbsp;команду:</p>
<pre><code>autopano-complete.sh -o output.pto *.jpg
</code></pre>
<p>Этот скрипт все сделает в автоматическом режиме без запуска графической оболочки, что очень удобно для автоматизации процесса&nbsp;:)</p>
<p>Так или иначе, в результате мы все равно получим файл output.pto в той же директории, что и jpg&nbsp;файлы.</p>
<p>Так как мы все-таки собираемся работать с файлами в <span class="caps">TIFF</span> формате, то теперь следует открыть файл output.pto в текстовом редакторе и исправить имена файлов c jpg на tif. Любители всяческой автоматизации могут так же использовать команду, которая сделает всю черную&nbsp;работу:</p>
<pre><code>sed s/&#46;jpg/.tif/ output.pto &gt; tmp.pto &amp;amp;&amp; mv tmp.pto output.pto
</code></pre>
<p>Теперь натравливаем на output.pto программу&nbsp;hugin:</p>
<pre><code>hugin output.pto
</code></pre>
<p>Если hugin спросит, то вводим кроп фактор, у меня это 1.5 на Nikon D50, для 35mm пленки надо ставить&nbsp;1.0:</p>
<p class="img_c"><img alt="" src="http://media.svetlyak.ru/blog/070905/hugin_crop_factor.png" title="hugin_crop_factor" /></p>
<p>А затем фокусное расстояние в&nbsp;миллиметрах:</p>
<p class="img_c"><img alt="" src="http://media.svetlyak.ru/blog/070905/hugin_focal_length.png" title="hugin_focal_length" /></p>
<p>Переключаемся на вкладку &#171;Оптимизатор&#187; (&#171;Optimizer&#187;) и выбираем пункт &#171;Позиции (y,p,r)&#187; (&#171;Positions (y, p, r)&#187;). Жмем кнопку &#171;Оптимизировать! (&#171;Optimize Now!&#187;) и затем &#8212; &#171;Применить&#187;&nbsp;(&#171;Apply&#187;).</p>
<p class="img_c"><img alt="" src="http://media.svetlyak.ru/blog/070905/hugin_optimizer.png" title="hugin_optimizer" /></p>
<p>Далее переключаемся на вкладку &#171;Сшиватель&#187; (&#171;Stitcher&#187;). Изменяем проекцию на &#171;Линейную&#187; (&#171;Rectilinear&#187;) после чего кликаем на кнопках &#171;Расчитать поле обзора&#187; (&#171;Calculate Field of View&#187;) и &#171;Расчитать оптимальный размер&#187; (&#171;Calculate Optimal&nbsp;Size&#187;).</p>
<p class="img_c"><img alt="" src="http://media.svetlyak.ru/blog/070905/hugin_stitcher.png" title="hugin_stitcher" /></p>
<p>В &#171;Параметрах экспорта панарамы&#187; (&#171;Output File Options&#187;) следует выбрать формат изображения &#171;Несколько файлов <span class="caps">TIFF</span>&#187; (&#171;Multiple <span class="caps">TIFF</span>&#187;) &#8212; это особенно важно, поскольку дает понять hugin&#146;у, что мы хотим получить на выходе несколько отдельный изображений, а не один склеенный&nbsp;файл.</p>
<p>Все, жмем кнопку &#171;Сшить!&#187; (&#171;Stitch Now!&#187;) и выбираем в качестве в качестве имени файла что-нибудь вроде &#171;out.tif&#187;, тогда hugin сгенерирует выходные tiff файлы, каждый из которых будет называться, out0000.tif, out0001.tif, и так&nbsp;далее.</p>
<p>Кстати, я нашел еще одну утилиту, позволяющую, судя по описанию, сводить изображения, предназначенные для создания <span class="caps">HDR</span>. Называется этот скрипт <a href="http://www.luxal.eu/resources/hdr/hdrprep/">hdrprep</a>. К сожалению, пока не было времени его&nbsp;опробовать.</p>
<p>Итак, hugin сгенерировал для нас <span class="caps">TIFF</span> файлы с альфа каналом, а pfstools такой формат не понимает. Поэтому следует избавиться от альфаканала с помощью утилиты из пакета&nbsp;ImageMagick:</p>
<pre><code>mogrify +matte out*.tif
</code></pre>
<h2>Создание профиля&nbsp;камеры</h2>
<p>Чтобы получить более адекватное <span class="caps">HDR</span> изображение, нам необходимо откалибровать камеру, и сохранить ее профиль в отдельном файле. Сначала сгенерируем файл, с описанием изображений с помощью команды <code>jpeg2hdrgen *.jpg &gt; test.hdrgen</code>. Этот файл содержит инвормацию, об условиях съемки каждого изображения. Данные извлекаются из exif&nbsp;тегов.</p>
<p>Теперь придется вручную поправить файл test.hdrgen, заменив каждое имя файла на соответствующее ему <b>output000?.tif</b>. Как правило, они идут по&nbsp;порядку.</p>
<p>Все, можно строить&nbsp;профиль:</p>
<pre><code>pfsinhdrgen test.hdrgen | pfshdrcalibrate -v -g 6 -s test.response
</code></pre>
<p>pfstools состоит из набора утилит, разделенных на группы. Одни утилиты отвечают за чтение данных разных форматов, другие &#8212; за преобразование, третьи &#8212; за сохранение и т.д.. Команды могут объединяться между собой в разных комбинациях, для чего их следует записывать через символ |, который обозначает unix-pipe, или, если по русски &#8212; &#171;трубу&#187;. По этой &#171;трубе&#187; данные передаются от одной утилиты к другой пока не сформируется конечный&nbsp;резыльтат.</p>
<p>Для большинства команд можно указывать дополнительные параметры. Например, параметр <b>-g 6</b> для pfshdrcalibrate позволяет избежать появления странных артефактов &#8212; вроде цветных или черных пятен на месте бликов и ярких источников света, а случае, если вы используете <span class="caps">TIFF</span> файлы c 16 битами на канал, необходимо явно указать это утилите pfshdrcalibrate c комощью опции <b>-b 16</b>. Подробнее обо всех параметрах можно узнать посмотрев документацию по той или иной утилите. Делается это очень&nbsp;просто:</p>
<pre><code>man &lt;имя утилиты&gt;
</code></pre>
<p>Профиль можно посмотреть с помощью программы Gnuplot. Например&nbsp;так:</p>
<pre><code>art@localhost$ gnuplot
Terminal type set to &amp;#146;x11&amp;#146;
gnuplot&gt; plot &#171;test.response&#187; with dots
</code></pre>
<p class="img_c"><img alt="" src="http://media.svetlyak.ru/blog/070905/gnuplot_response.png" title="gnuplot_response" /></p>
<h2>Создание <span class="caps">HDR</span> изображения (в HDRShop&nbsp;pfstools)</h2>
<p>Теперь настал момент создания <span class="caps">HDR</span> файла. Для этого достаточно запустить такую&nbsp;команды:</p>
<pre><code>pfsinhdrgen test.hdrgen | pfshdrcalibrate -v -f test.response | pfsoutexr test.exr
</code></pre>
<p>Ключ -f указывает pfshdrcalibrate использовать созданную на предыдущем этапе&nbsp;кривую.</p>
<p>Просмотреть получившееся изображение можно&nbsp;командой:</p>
<pre><code>pfsin test.exr | pfsview
</code></pre>
<h2>Тонирование и перевод в <span class="caps">LDR</span> (в pfstmo и&nbsp;qpfstmo)</h2>
<p>Для получения результирующего изображения, <span class="caps">HDR</span> картинку необходимо тонировать, преобразовать в <span class="caps">LDR</span>, поскольку вряд ли вы являетесь счастливым обладателем дорогостоящих аппаратных средств, позволяющих просматривать <span class="caps">HDR</span>&nbsp;напрямую.</p>
<p>Существуют разные алгоритмы перевода <span class="caps">HDR</span> в <span class="caps">LDR</span>, pfstools поддерживает целых 7. Для того, чтобы поиграться с настройками в интерактивном режиме существует графическая оболочка qpfstmo. Я, для сгенерировал пример применения каждого алгоритма с параметрами по умолчанию вот таким простым&nbsp;скриптом:</p>
<pre><code>for i in /usr/bin/pfstmo_*;do \
    echo $i; \
    pfsin test.exr | $i | pfsouttiff `basename $i`.tif; \
done
</code></pre>
<p>Этот скрипт сгенерирует вам по одной картинке для каждого алгоритма&nbsp;тонирования:</p>
<p class="img_fl">ashikhmin02<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/ashikhmin02_default.jpg" title="ashikhmin02_default" /></p>
<p class="img_fl">drago03<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/drago03_default.jpg" title="drago03_default" /></p>
<p class="img_fl">fattal02<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/fattal02_default.jpg" title="fattal02_default" /></p>
<p class="img_fl">pattanaik00<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/pattanaik00_default.jpg" title="pattanaik00_default" /></p>
<p class="img_fl">reinhard02<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/reinhard02_default.jpg" title="reinhard02_default" /></p>
<p class="cb" />
<p>Однако скорее всего, результаты будут неудовлетворительными из-за использования настроек &#171;по умолчанию&#187;. Чтобы получить лучшие результаты, нужно разбираться в параметрах каждого алгоритма или хотя бы поиграться с ними. Делать это удобнее всего не с командной строки, а с использованием графической оболочки&nbsp;qpfstmo:</p>
<p class="img_c"><img alt="" src="http://media.svetlyak.ru/blog/070905/fattal02_settings.png" title="fattal02_settings" /></p>
<p>Для удобства сравнения и скорости работы сразу выберите небольшой размер предпросмотра &#171;Work Size&#187;. Чек-бокс &#171;Open in New Window&#187; полезно включать, когда вы хотите открыть несколько окон с результатами обработки фото, например для сравнения разных алгоритмов или&nbsp;настроек.</p>
<p>Немного поэкспериментировав с параметрами алгоритмов я получил вот такие результаты (изображения даны без дополнительной&nbsp;обработки):</p>
<p class="img_fl">fattal02<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/test_fattal02_a0_154882_b0_5_s0_84.jpg" title="test_fattal02_a0_154882_b0_5_s0_84" /></p>
<p class="img_fl">pattanaik00<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/test_pattanaik00_m57_2237_l_c0_5_r0_5.jpg" title="test_pattanaik00_m57_2237_l_c0_5_r0_5" /></p>
<p class="img_fl">reinhard02<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/test_reinhard02_k1_s_p34_r3_l3_u59.jpg" title="test_reinhard02_k1_s_p34_r3_l3_u59" /></p>
<p class="img_fl">reinhard04<br />
<img alt="" src="http://media.svetlyak.ru/blog/070905/reinhard04_default.jpg" title="reinhard04_default" /></p>
<p class="cb" />
<p>По данным результатом видно, что алгоритм fattal02 позволяет получить более насыщенную картинку, однако он страдает большим недостатком &#8212; обратите внимание на ореолы, окружающие резкие переходы от светлых тонов к&nbsp;тёмным.</p>
<p>Алгоритмы pattanaik00 и reinhard так же дают неплохой результат, который может быть улучшен за счет дополнительной постобработки в <a href="http://www.gimp.org">The Gimp</a>.</p>
<h2>Ссылки</h2>
<ul>
<li><a href="http://www.linuxgraphics.ru/wiki/doku.php?id=tutorial-dphoto-creating-hdri-from-cli">Создание <span class="caps">HDR</span> c помощью pfstools с командной строки&nbsp;(русский)</a></li>
<li><a href="http://wiki.panotools.org/HDR_workflow_with_hugin">Склейка <span class="caps">HDR</span> панорам в hugin&nbsp;(английский)</a></li>
<li><a href="http://www.linuxgraphics.ru/wiki/doku.php?id=tutorial-dphoto-creating-hdri-from-cli">Подборка ссылок по <span class="caps">HDR</span>&nbsp;(русский)</a></li>
<li><a href="http://chris.quietlife.net/2006/09/06/hdr-and-tonemapping-in-linux/"><span class="caps">HDR</span> и тонирование в Linux&nbsp;(английский)</a></li>
<li><a href="http://theplaceofdeadroads.blogspot.com/2006/07/qpfstmo-hdr-tone-mapping-gui-for-linux_04.html">Описание <span class="caps">GUI</span> для выполнения тонирования <span class="caps">HDR</span> &#8212; qpfstmo&nbsp;(английский)</a></li>
<li><a href="http://ildar-gumerov.newmail.ru/hdri.htm">Статья про <span class="caps">HDR</span> и работу с ним в Photoshop и Photomatix&nbsp;(русский)</a></li>
<li><a href="http://www.stuckincustoms.com/index.php">Фотоблог с <span class="caps">HDR</span>&nbsp;(английский)</a></li>
<li><a href="http://community.livejournal.com/ru_hdr">Русскоязысное сообщество, посвященное&nbsp;<span class="caps">HDR</span></a></li>
<li><a href="http://www.mpi-inf.mpg.de/resources/pfstools/">Официальная страница pfstools&nbsp;(английский)</a></li>
<li><a href="http://www.mpi-sb.mpg.de/resources/hdr/calibration/pfs.html">Описание утилиты pfshdrcalibration с небольшим туториалом&nbsp;(английский)</a></li>
</ul>
                
                    <img style="border:0" src="/count/c/13/48/" alt="" />

                
                <p class="subscribe">Если вам понравилась эта статья, <a href="/feeds/">следите за будущими обновлениями</a>, используя RSS или подписку на email рассылку.</p>
            
            
        </div>

        
        
            
                
                    <div class="interests">
                        <h2 class="caps">Похожие статьи:</h2>
                        <ul class="related jcarousel jcarousel-skin-links">
                            
                                <li><a href="http://http://svetlyak.ru/blog/video-pro-sborku-obektiva/">Видео про сборку&nbsp;объектива</a></li>
                            
                                <li><a href="http://http://svetlyak.ru/blog/vernoj-dorogoj-idem-tovarischi/">Верной дорогой идем&nbsp;товарищи?</a></li>
                            
                                <li><a href="http://http://svetlyak.ru/blog/faked-tilt-and-shift-miniatyuryi/">Faked tilt <span class="amp">&amp;</span> shift&nbsp;миниатюры</a></li>
                            
                                <li><a href="http://http://svetlyak.ru/blog/vazelinovaya-magiya-75-stupeni/">Вазелиновая магия 75&nbsp;ступени</a></li>
                            
                                <li><a href="http://http://svetlyak.ru/blog/vyisokoskorostnaya-fotografiya/">Высокоскоростная&nbsp;фотография</a></li>
                            
                        </ul>
                        
                    </div>
                
            
        
        

        <div class="actions">
            <h2 class="caps">Поделиться:</h2> <span class="share-buttons"></span>
        </div>
        <script type="text/javascript">insert_share_links('.share-buttons', 'Боремся за динамический диапазон', 'Введение На сегодняшний день, в большинстве форматов хранения цифровых изображений для представления цвета и светимости точек ограниченное число бит, например 8 или 16 бит на канал. При этом, цвет кодируется таким образом, чтобы наилучшим образом учесть человеческое восприятие, для чего применяется так называемая &#171;гамма&nbsp;коррекция&#187;. Увы, с помощью ограниченного числа бит невозможно зафиксировать все то многообразие цветовых оттенков, что существует в реальном мире. Для обозначения диапазона яркостей, которые могут быть зафиксированы одновременно на носителе (фотоплёнке, фотобумаге, фотопластинке) либо с помощью матрицы цифрового фотоаппарата был введен специальный термин &#8212; динамический диапазон (или фотографическая&nbsp;широта). Чтобы обойти существующие ограничения широту динамического диапазона, была разработана ...');</script>

        





<div class="comments">
    
    
    
        <h2 class="clear">Всего комментариев:&nbsp;5</h2>
        
        
            




<table id="c161" class="comment even">
    <tr>
        <td rowspan="2"><div class="avatar" style="width:50px;height:50px;"><img src="http://media.svetlyak.ru/cache/avatars/a994b4ede7b02523fdb579c903d43e9f.png" width="50" height="50" /></div>
</td>
        <td class="meta">
            <div class="username">
                
                    
                    <span>abv</span>
                
            </div>
            <div class="date"><a href="/comments/cr/13/48/#c161" title="Постоянная ссылка на этот комментарий">Октябрь 23 2006 06:50</a></div>
        </td>
    </tr>
    <tr>
        <td class="body">
            <div class="container">
                <div class="message">
                    <p>Спасибо! Классная статья! Только надо было картинку получше поместить&#8230; ато все будут пугацца и думать, что инструментарий реализованный под линукс, хуже чем&nbsp;под&nbsp;виндовс&#8230;.</p>
                </div>
            </div>
            <div class="controls">
                
            </div>
        </td>
    </tr>
</table>

        
            




<table id="c186" class="comment odd">
    <tr>
        <td rowspan="2"><div class="avatar" style="width:50px;height:50px;"><img src="http://media.svetlyak.ru/cache/avatars/a8cc4e67e521f9ee0d3e3843f365cba1.png" width="50" height="50" /></div>
</td>
        <td class="meta">
            <div class="username">
                
                    
                    <span>Петр</span>
                
            </div>
            <div class="date"><a href="/comments/cr/13/48/#c186" title="Постоянная ссылка на этот комментарий">Октябрь 31 2006 15:35</a></div>
        </td>
    </tr>
    <tr>
        <td class="body">
            <div class="container">
                <div class="message">
                    <p>Скажите пожалуйста, а нет ли опыта сборки libpano и hugin под debian или ubuntu, в частности? После установки первого hugin при попытке&nbsp;configure&nbsp;выдает:</p>
<p>&#8230;.
checking for pano12/queryfeature.h&#8230; yes
panotools query functions enabled
checking for fcnPano in -lpano12&#8230; yes
checking for execute_stack_new in -lpano12&#8230; no
checking if Panotools package is complete&#8230; no &#8212; libpano12 version 2.8.1 or later is required
configure: error:
        the panorama tools library must be installed on your system
        but configure could not find it. Use &#8212;with-pano to
        specify the location of the&nbsp;panotools&nbsp;library</p>
                </div>
            </div>
            <div class="controls">
                
            </div>
        </td>
    </tr>
</table>

        
            




<table id="c191" class="comment even">
    <tr>
        <td rowspan="2"><div class="avatar" style="width:50px;height:50px;"><img src="http://media.svetlyak.ru/cache/avatars/bb41cbd5f06f3cec4284b6de1a24b1a1.png" width="50" height="50" /></div>
</td>
        <td class="meta">
            <div class="username">
                
                    
                    <span>Большой 40-ваттный Светляк</span>
                
            </div>
            <div class="date"><a href="/comments/cr/13/48/#c191" title="Постоянная ссылка на этот комментарий">Октябрь 31 2006 20:13</a></div>
        </td>
    </tr>
    <tr>
        <td class="body">
            <div class="container">
                <div class="message">
                    <p>Ни под дебианом, ни под ubuntu я hugin не собирал, так как &#171;живу&#187; с Gentoo и горя не&nbsp;знаю&nbsp;:)</p>
<p>Ну а какая версия libpano у вас установлена? Очевидно, что configure hugin&#8217;а находит заголовочные файлы libpano, но не находит самой библиотеки, которая должна называться как-то так: libpano12.la
Может так же быть и такое, что конфигурационный скрипт находит библиотеку, но в ней нет функции execute_stack_new, именно об этом сообщается в приведенном&nbsp;вами&nbsp;логе.</p>
                </div>
            </div>
            <div class="controls">
                
            </div>
        </td>
    </tr>
</table>

        
            




<table id="c227" class="comment odd">
    <tr>
        <td rowspan="2"><div class="avatar" style="width:50px;height:50px;"><img src="http://media.svetlyak.ru/cache/avatars/a8cc4e67e521f9ee0d3e3843f365cba1.png" width="50" height="50" /></div>
</td>
        <td class="meta">
            <div class="username">
                
                    
                    <span>Петр</span>
                
            </div>
            <div class="date"><a href="/comments/cr/13/48/#c227" title="Постоянная ссылка на этот комментарий">Ноябрь 11 2006 07:39</a></div>
        </td>
    </tr>
    <tr>
        <td class="body">
            <div class="container">
                <div class="message">
                    <p>Спасибо за ответ, проблема, мистическим образом, разрешилась&nbsp;сама&nbsp;=\</p>
                </div>
            </div>
            <div class="controls">
                
            </div>
        </td>
    </tr>
</table>

        
            




<table id="c340" class="comment even">
    <tr>
        <td rowspan="2"><div class="avatar" style="width:50px;height:50px;"><img src="http://media.svetlyak.ru/cache/avatars/c7f18da466419bc58cfdde0b6552d029.png" width="50" height="50" /></div>
</td>
        <td class="meta">
            <div class="username">
                
                    
                    <span>Большой 40-ваттный Светляк... &amp;quot; Обновление га</span>
                
            </div>
            <div class="date"><a href="/comments/cr/13/48/#c340" title="Постоянная ссылка на этот комментарий">Ноябрь 26 2006 23:13</a></div>
        </td>
    </tr>
    <tr>
        <td class="body">
            <div class="container">
                <div class="message">
                    <p>[&#8230;] Благодаря тому, что с недавних пор я занялся каталогизацией отснятых фотографий в f-spot, нашел несколько летних снимков, где так и просится применение <span class="caps"><span class="caps">HDR</span></span>. Тогда я об этой технологии толком ничего не знал, но иногда снимал с брекетингом, надеясь позже совместить фотографии в The Gimp. Если получится, переделаю изображения в статье про <span class="caps"><span class="caps">HDR</span></span>, а то уж слишком стрёмные там&nbsp;фото.&nbsp;[&#8230;]</p>
                </div>
            </div>
            <div class="controls">
                
            </div>
        </td>
    </tr>
</table>

        
    
    

    
        


    


    
        
        <div class="comment-form">
        <h2>Оставить комментарий</h2>
        
            
            
                <p>Чтобы оставить комментария, пожалуйста, <a href="/openid/login/?next=UydodHRwOi8vc3ZldGx5YWsucnUvYmxvZy80OC8nCnAwCi4.BwVYSfEcnaurepPMC-wNLvBLCY0">представьтесь</a>.</p>
            
        
        <h2>Подписаться на коментарии</h2>
        <form class="subscribe" action="/subs/subscribe/" method="POST">
            <input class="submit-post" type="submit" value="Подписаться" name="post"/>
            <input id="id_email" type="text" name="email" value=""/>
            <label for="email">Присылать&nbsp;комментарии&nbsp;на&nbsp;email:</label>
            <input type="hidden" name="subs_id"  value="blog.entry-48" />
            <input type="hidden" name="next" value="http://svetlyak.ru/blog/48/" />
            <p class="rss"><img src="http://media.svetlyak.ru/images/btn/feed-icon-16x16.png" />&nbsp;Подписаться&nbsp<a href="http://http://svetlyak.ru/comments/feeds/atom/13/48/">на RSS</a> или на RSS&nbsp;со <a href="http://feeds.feedburner.com/40-wt-firefly/comments">всеми комментами</a>.</p>
        </form>
        </div>
    
</div>

    

        </div>
        <!-- END Content -->

        
        

        <hr class="space" />

        
        <div class="footer">
            <div class="copyright">Права на все изображения и тексты, размещенные на этом сайте, принадлежат <a href="/blog/contacts/">Александру Артёменко</a>, но могут быть использованны с соответствии с лицензией <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons BY-NC-SA</a>. Используя эти материалы в коммерческих целях, без согласования с автором, вы навсегда лишитесь положительной кармы :)</div>
            

                <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1970967-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
(function(w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter217025 = new Ya.Metrika({id:217025, enableAll: true, webvisor:true});
        }
        catch(e) { }
    });
})(window, "yandex_metrika_callbacks");
</script></div>
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript" defer="defer"></script>
<noscript><div><img src="//mc.yandex.ru/watch/217025" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
            
<div class="b-buttons">
    <a href="http://www.djangoproject.com/"><img src="http://media.djangoproject.com/img/badges/djangosite80x15.gif" width="80" height="15" alt="A Django site." title="A Django site." /></a>
    <a href="http://photos.vfxy.com/photoblogs/2779"><img src="http://photos.vfxy.com/img/iam_vfxy.jpg" width="80" height="15" alt="VFXY Logo"/></a>
    <a href="http://lenta.yandex.ru/settings.xml?name=feed&amp;url=http%3A%2F%2Ffeeds.feedburner.com%2F40-wt-firefly"><img src="http://lenta.yandex.ru/i/addfeed.gif" width="100" height="22" alt="Yandex.Lenta"/></a>
    <a href="http://feeds.feedburner.com/40-wt-firefly"><img src="http://feeds.feedburner.com/~fc/40-wt-firefly?bg=DDDDDD&amp;fg=444444&amp;anim=0" width="88" height="26" alt="Feedburner"/></a>
    <a href="http://validator.w3.org/check/referer"><img src="http://media.svetlyak.ru/images/btn/w3c-xhtml.gif" width="80" height="15" alt="W3C XHTML Validator"/></a>
    <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="http://media.svetlyak.ru/images/btn/w3c-css.gif" width="80" height="15" alt="W3C CSS Validator"/></a>
    <a href="http://toodoo.ru/blog/5642/click?c=cyh8LfdREx1YQrDkM2Qsp" title="My toodoo.ru profile"><img src="http://c.toodoo.ru/blog/5642/images/88x15.gif" alt="readers online/total" /></a>
</div>

        </div>
        
</div> <!-- content -->
</body>
</html>
